node{

environment {
    registry = "pankajbhalerao2021/spring-boot-mongo"
    registryCredential = ‘dockerhub’
}
    
    stage("scm checkout"){
        
        checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'GIT_CREDENTIALS', url: 'https://github.com/pankajbhalerao2021/spring-boot-mongo-docker.git']]])
    }

     stage(" Maven Clean Package"){
      def mavenHome =  tool name: "Maven-3.6.3", type: "maven"
      def mavenCMD = "${mavenHome}/bin/mvn"
      sh "${mavenCMD} clean package"   
        
    }
    
     stage('Build Docker Image'){
        sh 'docker build -t pankajbhalerao2021/spring-boot-mongo .'
    }
    
    
    stage('Push Docker Image'){
        
         	       
        docker.withRegistry('https://registry.hub.docker.com', 'docker-hub-credentials') {
            
           			sh 'docker push pankajbhalerao2021/spring-boot-mongo'
					
											 	
		     }
			 }
	        
    
}
